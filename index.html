<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>ç½‘ç»œå‡æ¸©é—®å·</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  overflow: hidden;
  font-family: "å¾®è½¯é›…é»‘", sans-serif;
}

/* åŠ è½½é¡µ */
#loading {
  position: fixed;
  inset: 0;
  background: url('image/loading.jpg') center center / cover no-repeat;
  z-index: 10;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: opacity 0.8s ease;
}
#loading.fade-out {
  opacity: 0;
  pointer-events: none;
}

.loading-overlay {
  background: rgba(0, 0, 0, 0.25);
  backdrop-filter: blur(4px);
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

.loading-text {
  text-align: center;
  color: #fff;
  animation: fadeInUp 1s ease;
}

.loading-text h1 {
  font-size: 28px;
  font-weight: bold;
  margin-bottom: 25px;
  text-shadow: 0 2px 6px rgba(0,0,0,0.4);
}

/* æµ…è“è‰²æŒ‰é’®é£æ ¼ */
#start-btn {
  background: linear-gradient(135deg, #2a75ac, #66b3ff);
  border: none;
  border-radius: 25px;
  padding: 12px 40px;
  color: white;
  font-size: 18px;
  font-weight: 500;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(102,179,255,0.4);
  transition: all 0.3s ease;
}
#start-btn:hover {
  background: linear-gradient(135deg, #89c9ff, #4fa3ff);
  transform: scale(1.05);
}

/* ä¸»ä½“ */
#questionnaire {
  display: none;
  background: url('image/background.jpg') center center / cover no-repeat;
  background-size: cover;
  height: 100%;
  color: #fff;
  text-align: center;
  position: relative;
}

/* åŠ¨ç”»æ·¡å…¥ */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(40px); }
  to { opacity: 1; transform: translateY(0); }
}

/* æ°”æ³¡åŠ¨ç”»å®¹å™¨ */
#bubbles {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
  z-index: 0;
}

.bubble {
  position: absolute;
  bottom: -50px;
  background-size: contain;
  background-repeat: no-repeat;
  opacity: 0.7;
  animation: rise linear infinite;
}
@keyframes rise { 
  0% { transform: translateY(0); opacity: 0.8; }
  100% { transform: translateY(-120%); opacity: 0; }
}

/* é—®é¢˜å¡ç‰‡ */
.question {
  display: none;
  position: absolute;
  width: 80%;
  left: 10%;
  top: 25%;
  background: rgba(255,255,255,0.15);
  border-radius: 15px;
  backdrop-filter: blur(10px);
  animation: fadeInUp 0.6s ease;
  z-index: 1;
}
.question.active { display: block; }
.question h2 {
  font-size: 20px;
  line-height: 1.6;
  margin-bottom: 20px;
}
.options button {
  display: block;
  width: 100%;
  margin: 10px auto;
  padding: 12px;
  background: rgba(255,255,255,0.2);
  color: #fff;
  border: 1px solid rgba(255,255,255,0.5);
  border-radius: 25px;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s;
}
.options button:hover { background: rgba(255,255,255,0.4); }

/* è¿”å›æŒ‰é’® */
.btn-back {
  position: absolute;
  top: -15px;
  left: -15px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: none;
  background: rgba(255,255,255,0.3);
  color: #fff;
  font-size: 18px;
  cursor: pointer;
  z-index: 2;
  display: none;
  transition: background 0.3s;
}
.btn-back:hover { background: rgba(255,255,255,0.6); }

/* æ¸©åº¦è®¡ */
.thermo-container {
  position: absolute;
  right: 20px;
  bottom: 50px;
  width: 20px;
  height: 150px;
  border: 2px solid #fff;
  border-radius: 10px;
  background: rgba(255,255,255,0.2);
  overflow: hidden;
}
.thermo-fill {
  position: absolute;
  bottom: 0;
  width: 100%;
  background: linear-gradient(to top, #00bfff, #ff0000);
  height: 50%;
  transition: height 0.8s ease;
}

/* å¼¹çª—ç»“æœ */
#result-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(5px);
  z-index: 20;
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: rgba(255,255,255,0.2);
  border-radius: 20px;
  padding: 30px;
  width: 80%;
  max-width: 320px;
  color: #fff;
  text-align: center;
  animation: fadeInUp 0.6s;
}
#temp-value {
  font-size: 38px;
  margin: 10px 0;
  color: #ffdb4d;
}
.modal-content button {
  width: 80%;
  margin: 10px auto;
  padding: 12px;
  border: none;
  border-radius: 25px;
  font-size: 16px;
  color: #fff;
  cursor: pointer;
}
.btn-generate { background: #ff6666; }
.btn-retry { background: #66b3ff; }

/* åˆ†äº«é¡µ */
#share {
  display: none;
  position: fixed;
  inset: 0;
  background: url('image/background.jpg') center/cover no-repeat;
  text-align: center;
  color: #fff;
  z-index: 25;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  animation: fadeInUp 0.8s ease;
}
#share .card {
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 30px 20px;
  width: 80%;
  max-width: 340px;
}
#share h3 {
  font-size: 22px;
  margin-bottom: 10px;
}
#share p {
  font-size: 18px;
  margin: 10px 0 20px;
}
#share img {
  width: 100px;
  height: auto;
  margin: 10px;
  object-fit: contain;
  background: transparent;
}
#share button {
  margin-top: 15px;
  padding: 10px 20px;
  border-radius: 25px;
  border: none;
  color: white;
  background: #66b3ff;
  font-size: 16px;
  cursor: pointer;
}

/* åˆ†äº«é¢„è§ˆå¼¹çª— */
#share-preview {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.7);
  backdrop-filter:blur(5px);
  justify-content:center;
  align-items:center;
  z-index:30;
  flex-direction:column;
  color:#fff;
}
#share-preview button{
  margin-top:12px;
  border:none;
  border-radius:25px;
  padding:10px 25px;
  font-size:16px;
  cursor:pointer;
}
#downloadBtn{ background:#66b3ff; color:#fff; }
#closePreview{ background:rgba(255,255,255,0.3); color:#fff; }
</style>
</head>
<body>

<!-- åŠ è½½é¡µ -->
<div id="loading">
  <div class="loading-overlay">
    <div class="loading-text">
      <h1>ä½ è®©ç½‘ç»œå‡æ¸©å‡ åº¦ï¼Ÿ</h1>
      <button id="start-btn">å¼€å§‹æµ‹é‡</button>
    </div>
  </div>
</div>

<div id="questionnaire">
  <div id="bubbles"></div>
  <div class="thermo-container"><div class="thermo-fill" id="thermo-fill"></div></div>

  <!-- é—®é¢˜1 -->
  <div class="question active" data-change="10">
    <button class="btn-back" onclick="goBack()">â†</button>
    <h2>çœ‹åˆ°æœ‰äººè¢«ç½‘ç»œæš´åŠ›æ—¶ï¼Œä½ ä¼šï¼Ÿ</h2>
    <div class="options">
      <button data-change="-10">Aï¼šæ—è§‚</button>
      <button data-change="16.5">Bï¼šä¸¾æŠ¥</button>
      <button data-change="16.5">Cï¼šç•™è¨€å®‰æ…°</button>
    </div>
  </div>

  <!-- é—®é¢˜2 -->
  <div class="question" data-change="10">
    <button class="btn-back" onclick="goBack()">â†</button>
    <h2>ä½ åœ¨è¯„è®ºåŒºæœ€å¸¸ç”¨çš„è¡¨æƒ…æ˜¯ï¼Ÿ</h2>
    <div class="options">
      <button data-change="16.5">ğŸ˜Š å¾®ç¬‘</button>
      <button data-change="8">ğŸ˜ å†·é™</button>
      <button data-change="-16.5">ğŸ˜  ç”Ÿæ°”</button>
    </div>
  </div>

  <!-- é—®é¢˜3 -->
  <div class="question" data-change="10">
    <button class="btn-back" onclick="goBack()">â†</button>
    <h2>å¦‚æœçœ‹åˆ°ä¸åŒæ„è§ï¼Œä½ ä¼šï¼Ÿ</h2>
    <div class="options">
      <button data-change="-16.5">Aï¼šäº‰è®º</button>
      <button data-change="16.5">Bï¼šç†æ€§å›å¤</button>
      <button data-change="8">Cï¼šç¦»å¼€</button>
    </div>
  </div>
</div>

<!-- ç»“æœå¼¹çª— -->
<div id="result-modal">
  <div class="modal-content">
    <h2>ä½ çš„ç½‘ç»œæ¸©åº¦æ˜¯</h2>
    <div id="temp-value">0Â°</div>
    <p>â€”â€” æš–å¿ƒç½‘æ°‘ â¤ï¸ â€”â€”</p>
    <button class="btn-generate" id="btn-share">ç”Ÿæˆåˆ†äº«å›¾</button>
    <button class="btn-retry" onclick="restart()">å†æ¬¡æµ‹é‡</button>
  </div>
</div>

<!-- åˆ†äº«é¢„è§ˆå¼¹çª— -->
<div id="share-preview">
  <canvas id="shareCanvas" width="400" height="600" style="border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.5);"></canvas>
  <button id="downloadBtn">ä¸‹è½½å›¾ç‰‡</button>
  <button id="closePreview">å…³é—­</button>
</div>

<script>
const loading=document.getElementById('loading');
const questionnaire=document.getElementById('questionnaire');
const thermo=document.getElementById('thermo-fill');
const questions=document.querySelectorAll('.question');
const resultModal=document.getElementById('result-modal');
const tempValue=document.getElementById('temp-value');
const share=document.getElementById('share');
const finalTempText=document.getElementById('final-temp-text');
const bubblesContainer=document.getElementById('bubbles');

let current=0,temp=50,tempHistory=[temp];

// ç‚¹å‡»å¼€å§‹æŒ‰é’®è¿›å…¥é—®å·
window.addEventListener('load',()=>{
  const startBtn = document.getElementById('start-btn');
  startBtn.addEventListener('click',()=>{
    loading.classList.add('fade-out');
    setTimeout(()=>{
      loading.style.display='none';
      questionnaire.style.display='block';
      updateBackButton();
    },800);
  });
});

// æ°”æ³¡åŠ¨ç”»
function createBubble(){
  const bubble=document.createElement('div');
  bubble.className='bubble';
  const emojiArr=['ğŸ˜Š','ğŸ˜','ğŸ˜ ','â¤ï¸','ğŸ‘'];
  bubble.textContent=emojiArr[Math.floor(Math.random()*emojiArr.length)];
  bubble.style.left=Math.random()*80+'%';
  bubble.style.fontSize=(Math.random()*20+20)+'px';
  bubble.style.animationDuration=(Math.random()*5+4)+'s';
  bubblesContainer.appendChild(bubble);
  setTimeout(()=>bubblesContainer.removeChild(bubble),8000);
}
let bubbleInterval;
function startBubbles(){bubbleInterval=setInterval(createBubble,600);}
function stopBubbles(){if(bubbleInterval) clearInterval(bubbleInterval);}

// é—®é¢˜é€‰æ‹©
document.querySelectorAll('.options button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const change=Number(btn.dataset.change);
    temp=Math.min(100,Math.max(0,temp+change));
    thermo.style.height=temp+'%';
    tempHistory.push(temp);

    questions[current].classList.remove('active');
    current++;
    if(current<questions.length){
      questions[current].classList.add('active');
      updateBackButton();
      if(current===1) startBubbles(); else stopBubbles();
    } else {
      stopBubbles();
      showResult();
    }
  });
});

function goBack(){
  if(current===0)return;
  questions[current].classList.remove('active');
  current--;
  questions[current].classList.add('active');
  tempHistory.pop();
  temp=tempHistory[tempHistory.length-1]||50;
  thermo.style.height=temp+'%';
  updateBackButton();
  if(current===1) startBubbles(); else stopBubbles();
}

function updateBackButton(){
  questions.forEach((q,i)=>{
    const btn=q.querySelector('.btn-back');
    if(btn) btn.style.display=(i>0&&i===current)?'block':'none';
  });
}

// æ˜¾ç¤ºç»“æœå¼¹çª—
function showResult(){
  questionnaire.style.display='block';
  resultModal.style.display='flex';
  let displayTemp=0;
  const finalTemp=Math.round(temp);
  const timer=setInterval(()=>{
    if(displayTemp<finalTemp){
      displayTemp++;
      tempValue.textContent=displayTemp+'Â°';
    } else clearInterval(timer);
  },30);
  finalTempText.textContent=`æˆ‘çš„ç½‘ç»œæ¸©åº¦ä¸º ${finalTemp}Â°`;
}

// ç”Ÿæˆåˆ†äº«å›¾é¢„è§ˆ
document.getElementById('btn-share').onclick = async () => {
  resultModal.style.display = 'none';

  const bg = await loadImage('image/share.jpg');
  const qr = await loadImage('image/qrcode.png');
  const canvas = document.getElementById('shareCanvas');
  canvas.width = 300;
  canvas.height = 450;
  const ctx = canvas.getContext('2d');

  // èƒŒæ™¯
  ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);
  ctx.fillStyle='#fff';
  ctx.font='24px "å¾®è½¯é›…é»‘"';
  ctx.textAlign='center';
  ctx.fillText('æˆ‘ä¸ºç½‘ç»œå‡æ¸©1Â°', canvas.width/2, 200);
  ctx.fillStyle='#ffdb4d';
  ctx.font='bold 30px "å¾®è½¯é›…é»‘"';
  ctx.fillText(`æˆ‘çš„ç½‘ç»œæ¸©åº¦ï¼š${Math.round(temp)}Â°`, canvas.width/2, 260);
  const qrSize=80;
  ctx.drawImage(qr, canvas.width/2-qrSize/2 - 85, canvas.height-qrSize-15, qrSize, qrSize);
  ctx.fillStyle='#999999';
  ctx.font='16px "å¾®è½¯é›…é»‘"';
  ctx.fillText('æ‰«ç æµ‹æµ‹ä½ çš„ç½‘ç»œæ¸©åº¦', canvas.width/2+55, canvas.height-15);

  //document.getElementById('share-preview').style.display='flex';

  const sharePreview = document.getElementById('share-preview');
  sharePreview.style.opacity = '0';
  sharePreview.style.display = 'flex';
  
  // è§¦å‘åŠ¨ç”»
  setTimeout(() => {
    sharePreview.style.transition = 'opacity 0.5s ease-in-out';
    sharePreview.style.opacity = '1';
  }, 10);
};

function loadImage(src){
  return new Promise((resolve,reject)=>{
    const img=new Image();
    img.crossOrigin="anonymous";
    img.onload=()=>resolve(img);
    img.onerror=reject;
    img.src=src;
  });
}

document.getElementById('downloadBtn').onclick=()=>{
  const canvas=document.getElementById('shareCanvas');
  const link=document.createElement('a');
  link.download='æˆ‘çš„ç½‘ç»œæ¸©åº¦åˆ†äº«å›¾.jpg';
  link.href=canvas.toDataURL('image/jpeg');
  link.click();
};

document.getElementById('closePreview').onclick=()=>{
  document.getElementById('share-preview').style.display='none';
  resultModal.style.display='flex'; // æ˜¾ç¤ºç»“æœå¼¹çª—
};

// é‡å¯
function restart(){
  stopBubbles();
  share.style.display='none';
  resultModal.style.display='none';
  questionnaire.style.display='block';
  current=0;
  temp=50;
  tempHistory=[temp];
  thermo.style.height=temp+'%';
  questions.forEach((q,i)=>q.classList.toggle('active',i===0));
  updateBackButton();
}
</script>
</body>
</html>

